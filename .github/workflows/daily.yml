name: Fund Sentinel (Daily Check)

on:
  schedule:
    - cron: '47 6 * * 1-5' # 06:47 UTC = 14:47 Beijing (Signal Check)
    - cron: '17 7 * * 1-5' # 07:17 UTC = 15:17 Beijing (Daily Report)
  workflow_dispatch:

# ğŸ”¥ æ ¸å¿ƒå˜åŒ–1ï¼šèµ‹äºˆå†™å…¥ä»“åº“çš„æƒé™
permissions:
  contents: write

jobs:
  check_and_push:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
          
      - name: Install dependencies
        run: pip install requests
          
      - name: Run Sentinel Script
        env:
          BARK_KEY: ${{ secrets.BARK_KEY }}
          PUSHPLUS_TOKEN: ${{ secrets.PUSHPLUS_TOKEN }}
        run: python daily_check.py
        
      # ğŸ”¥ æ ¸å¿ƒå˜åŒ–2ï¼šå¦‚æœæ—¥è®°æ–‡ä»¶è¢«ä¿®æ”¹äº†ï¼ŒæŠŠå®ƒæäº¤å›ä»“åº“
      - name: Commit and Push Log
        run: |
          git config --global user.name "FundBot"
          git config --global user.email "bot@github.com"
          git add signals.md report_status.json
          # åªæœ‰å½“æ–‡ä»¶æœ‰å˜åŒ–æ—¶æ‰æäº¤ï¼Œå¦åˆ™ä¸æŠ¥é”™
          git commit -m "ğŸ“ Update signal log & status" || echo "No changes to commit"
          git push
